# GPU Gems New Code

# 说明
* 案例开发环境为 Windows 10 + Unity 2019.4.9f1 + Visual Studio 2019，其中 DirectX 12 版本的代码必须在 Windows 10 环境中才能运行，代码使用了龙书的代码框架。

# Chapter 1 Water Simulation
* 水面模拟一直是一个很难的话题，虽然 GPU Gems 是一本很老的教程，但是实现的水面效果还是很不错的。本案例中依次实现了两种形式的正弦近似值的加和、
圆形波和 Gerstner 四种波，其中公式均基于原书推导而得，在 Unity Shader 中可以很方便看出效果。几种波的对比如下：  
① 正弦波累加：这种波形比较圆润，而且如果将网格扩大范围会发现很多地方其实是重复的，可以应用在小池塘的风吹效果。  
② 正弦波累加的次方：这种波形是正弦波累加的优化，目的是让高度差更明显，但是还是存在重复的问题。  
③ 圆形波：这种波形也是相对圆润的波形，可以模拟在池塘上丢一块石头的效果。  
④ Gerstner 波：这种波形不仅高度差非常明显，而且在效果上观看不是很规律，适合模拟海洋这样粗犷的水面。

# Chapter 2 Water Caustics
* 水的焦散效果是一种很漂亮的效果，但是在书中和案例的代码中，都没有使用基于物理计算的焦散效果，都是一种大胆的假设，在一定程度上满足视觉体验。总体来说，我们实现焦散的步骤如下：  
① 创建两个 Pass，其中一个负责渲染水下的表面，另一个 Pass 负责水面计算。  
② 通过计算水面网格的顶点法线和平面的顶点法线，通过假想方程来计算“太阳”贴图的采样坐标。  
③ 渲染水面，并与平面颜色混合。  
整个过程对波浪和焦散的参数控制要求很高，因为假想方程很容易产生误差，基于现有的 Unity 技术，可以考虑使用投射器(Projector)来实现物理计算的焦散效果。

# Chapter 7 Rendering Countless Blades of Waving Grass
* 无尽草地渲染是一个很有意思的话题，在很多游戏中都有高质量的草地渲染，并且还有很好的草地随风飘动效果。在书中实用的方法都是基于星型结构拓展的，但是星型结构在上方观看很容易发现瑕疵。
因此在这里使用了两种方式渲染草地，第一种方式是书中的做法，第二种方式是使用几何着色器实现，两种方式各有优劣：  
方法一：  
① 使用一个 Quad 制作一片草，并将多片草组合形成星型结构；  
② 在场景中大量摆放草地，在位置和旋转上都需要随机性；  
③ 草的 Shader 处理方式很简单，只需要筛选出 UV 坐标 y 轴上较大的值的顶点，然后这些顶点按照一定的规律运动即可。  
优点：  
① 草体可以有丰富的材质，形成多种草体互相交融的效果；  
② 草体能够很方便地接收和投射阴影；  
③ 在相对水平视觉上草体很密集，不容易穿帮。  
缺点：  
① 性能消耗很大，在大量草体渲染中 Draw Call 很大；  
② 在上方视角观察时很容易看到草地的星型结构。  
方法二：  
① 在场景中创建大量的 Point 结构，然后使用几何着色器拓展顶点，形成独立的草体；  
② 草体创建后默认是单一的朝向，需要在几何着色器中进行随机旋转；  
③ 针对草体的高度，可以使用更加复杂的算法模拟更复杂的运动效果。  
优点：  
① 单个草体拥有多段结构，可以实现复杂的动画效果，还可以根据距离差异实现 LOD；  
② 性能消耗低，在大量草体渲染情况下性能消耗能够很好控制，可以在移动端使用；  
③ 草体完全随机，没有星型结构，不会产生规律的结构。  
缺点：  
① 投射阴影和接收阴影都不容易实现；  
② 草体纹理颜色相对单一，不能产生丰富的草地效果。  
